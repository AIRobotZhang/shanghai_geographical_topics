区域功能语义挖掘
=============

本项目主要基于带有位置信息的社交媒体数据中的文本数据进行分析，对区域功能语义属性进行挖掘，涉及到主要方法包括：文本处理、自然语言处理、主题模型等。目前，主流社交媒体及商铺点评等应用均支持用户对所处位置进行标注，国内外主流社交媒体包括有微博、Twitter等，商铺点评包括有大众点评、Yelp等。用户对所处位置进行标注主要可以分为两种方式，其一是直接基于GPS定位技术标记出经纬度信息，其二是标记出所处位置对应的商铺名及街道名等。为了能够进行统一处理，通常需要借助地址反查技术，将商铺名及街道名转换成经纬度。针对城市不同区域功能语义进行挖掘，一方面能够通过用户移动轨迹以及所发送的带有位置信息的文本信息，挖掘出用户行为所携带的语义信息，揭示出用户出行的目的，一方面能够结合群体用户的语义信息，挖掘出公共事件，例如在地震发生之后，借助微博或Twitter上的位置与语义信息能够对地震对不同区域所造成的影响程度进行估计，包括对伤亡人数的估计，同时找到潜在需要救助的人群，又例如在更大的空间尺度上进行挖掘，在英国公投或美国大选的过程中，均有借助社交媒体对不同城市不同区域的选民进行民意挖掘，并基于此对公投或大选的结果进行预测或干预。本项目主要借助社交媒体及商铺点评中带有地理位置的文本信息进行挖掘，对不同地点的潜在功能语义属性进行推测。

数据采集与数据集
----

本项目的实验数据主要包括两个来源：微博和Yelp。微博是目前中国最为流行的移动社交平台之一，据估计，微博普及率占到中国全部网民的90%左右。本项目首先针对微博数据基于互联网爬虫进行采集，爬取了上海市主要城区2015年全年带有位置信息的微博数据。由于一些位置访问人数较少，仅能采集到少量微博数据，不足以满足统计性假设进行分析，因此对地点进行了一步筛选，仅筛选出了其中带有大量微博数据的地点进行分析。Yelp是美国等一些国家主流的商铺评分以及评论平台，类似于国内的大众点评，Yelp数据集来源于公开数据集，包含了用户的评论以及评论的商铺的名称，可以同POI地理位置数据进行关联，扩充经纬度信息。所用数据集的基本信息统计如表。

![Alt Text](https://raw.githubusercontent.com/qiangsiwei/shanghai_geographical_topics/master/figure/01.png)

区域功能语义提取模型
----

本项目基于主题模型对区域功能语义属性进行提取，不同于一般的主题模型，该模型能够对全局与局部（与区域相关）的主题进行区分，并根据不同关键词的生成概率，对其在不同区域的本地性进行估计。首先介绍模型的推导，包括模型的生成过程（Generative process）和模型的推理过程（Inference process），之后对模型的验证方法和实验结果进行描述。

在本项目的模型场景下，假设数据集由文档d（一篇微博或点评评论）构成，文档d由一组关键词Wd构成，同时带有地理位置标签l。区域主题z通常由一组关键词进行表示，能够反映出区域所承载的功能语义属性，不同区域可以共享相同的主题，每个区域的特征可由其在不同主题上的分布概率p(z|l)进行表示，具有相似主题分布的区域通常具有较大的相似性。模型的构建主要基于以下假设，其一，在空间位置上临近的关键词更可能归属于相同的主题，这是因为相同地点更可能促使用户使用类似的描述用语，因此主题由标注为某区域的所有文档进行估计，而非单篇文档；其二，本地词（能解释区域特定功能属性的词）更可能具有相对集中的空间分布（相对于随机分布），例如，英文中关键词“Bravo”通常用于对表演者进行赞扬，因此更可能与剧院、演唱会等相关，而噪音词，诸如“Happy”、“love”或“city”等，均没有明确的区域指向性。

如图是模型的图表示（Graphical representation），由于该模型能够对全局（Global）和局部（Local）主题进行区分，因此命名为局部-全局主题模型（Local-Global topic model/LGLDA）。如图所示，深色节点表示观测变量或先验变量，浅色节点表示隐含变量。为了能够对全局主题或局部主题的相对权重进行控制，增加了变量局部全局权值比lambda。

![Alt Text](https://raw.githubusercontent.com/qiangsiwei/shanghai_geographical_topics/master/figure/02.png)

模型的生成过程如算法所示。

![Alt Text](https://raw.githubusercontent.com/qiangsiwei/shanghai_geographical_topics/master/figure/03.png)

在模型推理过程中采用折叠吉布斯采样（Collapsed Gibbs sampling）基于迭代过程对模型参数进行优化。通常在统计学中，在基于指定多元概率分布直接进行采样较为困难时，可以通过采用吉布斯采样获得观测序列进行近似。吉布斯采样是一种马尔可夫链蒙特卡罗（Markov chain Monte Carlo/MCMC）算法，经常用于贝叶斯推断（Bayesian inference）。马尔可夫链蒙特卡罗包含很多算法，其中最为常用的是梅特罗波利斯（Metropolis-Hastings/MH）算法，吉布斯采样是梅特罗波利斯算法的一种特例。梅特罗波利斯算法基于马尔可夫链的细致平衡，获得联合分布的采样，基于联合分布采样可以对边缘分布进行估计，其在贝叶斯推断求后验分布中发挥重要作用。折叠吉布斯采样在吉布斯采样的基础上，通过积分避开了实际待估计的参数，转而对隐含变量和观测变量进行采样，一旦每个隐含变量和观测变量的取值确定下来，被积分的值可以在统计取值频次后被计算出来。

模型的推断过程如算法所示。

![Alt Text](https://raw.githubusercontent.com/qiangsiwei/shanghai_geographical_topics/master/figure/04.png)

区域功能语义提取结果
----

针对原始文本数据，首先进行了分词、词性标注、停用词过滤等一系列标准的文本预处理工作，之后进行词频统计剔除掉了出现次数少于3的词，并将保留下来的词作为关键词进行下一步的分析。为了验证模型的性能，将其与以下三个模型进行比较。

*   基于TF-IDF的K-Means聚类模型（TF-IDF）   
基于TF-IDF的K-Means聚类模型首先采用TF-IDF算法将文本表示成为TF-IDF对应的特征向量。TF-IDF本质是一种统计方法，主要基于文档中的词频和包含该词的文档频率，计算关键词在文档中的重要程度。之后根据区域对所有文档的特征向量进行求和，将其作为该区域的特征向量。最后采用K-Means聚类算法对区域按照特征向量进行聚类。不同类别的聚类中心对应了不同主题，聚类中心向量相对于原点的偏离距离，对应了关键词在该主题中的重要性程度，偏离距离越远，对应关键词的重要性程度越高。

*   基于位置聚合的LDA模型（LDA）   
基于位置聚合的LDA模型基于标准的LDA模型，在初始计算主题模型的过程中不考虑不同文档的位置标签，之后某个区域的主题由区域对应的所有文档的主题分布聚合得到。

*   局部LDA模型（LocalLDA）   
局部LDA模型类似于大多数已有工作的主题模型。与LDA模型的区别在于在计算主题模型的过程就已经考虑了文本的位置信息，加入了区域的层级，与LGLDA模型的区别在于没有考虑全局主题（即噪音）。

为了对各个主题模型的性能进行评估和比较，采用了以下的四个评价指标，分别是模型的困惑度（Perplexity）、主题熵值、位置熵值、KL散度（Kullback–Leibler divergence）。困惑度是对主题模型进行评价的主要指标，表征了概率模型的概率分布中预测结果与样本之间的契合程度，困惑度越低说明契合越准确。主题熵值、位置熵值用于计算与位置相关的文本主题是否集中鲜明，在信息论中熵值通常用于衡量信息所含信息量大的大小，熵值越大说明不同区域均能够聚焦于少数主题，挖掘出的主题更能反映出位置所承载的功能属性，或者主题的分布均能够聚焦于少数区域，挖掘出的主题更能反映出不同区域功能属性的差异性。KL散度用于计算挖掘出的主题之间的相似性，KL散度数值越大，说明主题之间相似度越低，区分性越强。

通过实验确定局部全局权值比lambda，结果如图，可见随着lambda从0.1到20逐渐增大，模型的困惑度先减小后增大，并在lambda=0.6时取得最小值，主题熵值和KL散度的变化也印证了该取值。

![Alt Text](https://raw.githubusercontent.com/qiangsiwei/shanghai_geographical_topics/master/figure/05.png)

为了说明模型在区分本地词和噪音词上的有效性，定义关键词的本地性指数为其抽样自局部主题的概率和抽样自全局主题的概率的比值，本地性指数越高，说明该关键词和区域的相关性越高。如表是基于微博数据集中抽样得到的带有“外滩”位置标签的具有不同本地性指数的三条微博的文本内容，可见，具有较高本地性指数的微博正文中多次出现了与位置相关性很高的地标等关键词，而较低本地性指数的微博可能只出现了少数间接相关或无关的关键词，因此说明了模型的有效性。

![Alt Text](https://raw.githubusercontent.com/qiangsiwei/shanghai_geographical_topics/master/figure/06.png)

如表是不同模型在四个评价指标上的表现。从微博和Yelp两份数据集的实验结果来看，本项目提出的LGLDA模型优于其他模型，具有更低的模型困惑度，更高的主题熵值和位置熵值，说明该模型对于数据具有更好的契合度，在去除与位置无关的噪音信息后，更能反映出区域所承载的功能属性，以及不同区域功能属性的差异性。

![Alt Text](https://raw.githubusercontent.com/qiangsiwei/shanghai_geographical_topics/master/figure/07.png)

如表分别是基于微博数据集和Yelp数据集挖掘出的区域主题结果的示例。这里仅列出了挖掘出最主要的三个主题，每个主题由其中具有最高的概率的五个关键词进行表达。从最终的主题挖掘结果来看，LGLDA模型优于其他模型，以微博数据集为例，主题1中包含了大量与区域位置无关的词，在对比的三个模型中，主题1在大多数区域都具有较高的分布概率，对挖掘结果构成了影响，而在LGLDA模型中，主题1被标记为噪音，因此从与区域相关的主题中被过滤了，同时从主题2和主题3的主题关键词来看，LGLDA给出的关键词与主题的相关性更高，而其他模型的结果中仍存在不少噪音，例如主题2的语境是学校，但TF-IDF中包含了“心情”这个噪音词，主题3的语境是旅游景点，但LDA和LocalLDA中包含了“城市”、“上海”、“酒店”、“中心”等噪音词。另一方面，经过进一步统计分析，在LGLDA模型中，主题1和主题4占据了全局主题概率分布的0.988，说明LGLDA模型能够对全局和局部主题做出良好的区分。同时，在过滤掉噪音信息之后，每个区域对应的主题分布更加集中鲜明，以地点东方明珠为例，在LGLDA模型中，主题3的概率分布达到了0.933，而在LocalLDA模型中主题1和主题3的概率分布为0.425和0.414，其他主题的概率分布为0.161，主题分布较为杂糅。Yelp数据集也揭示出类似的结论。

![Alt Text](https://raw.githubusercontent.com/qiangsiwei/shanghai_geographical_topics/master/figure/08.png)

![Alt Text](https://raw.githubusercontent.com/qiangsiwei/shanghai_geographical_topics/master/figure/09.png)

